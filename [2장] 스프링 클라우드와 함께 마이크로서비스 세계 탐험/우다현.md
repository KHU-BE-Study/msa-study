# 2. 스프링 클라우드와 함께 마이크로서비스 세계 탐험

> 시스템이 더 많이 분산될수록 실패할 곳은 더 많아진다.
> 

⇒ MSA 구축 시 다양한 관리 업무 및 동기화 난제나 실패 지점을 경험하는 주된 이유!!

⇒ 스프링 클라우드는 최소한의 구성으로 MSA를 빠르게 구축할 수 있는 서비스 등록, 디스커버리, 회로 차단기, 모니터링 제공


<br>

## 2.1 스프링 클라우드란?

https://spring.io/projects/spring-cloud

- *스프링 프레임워크 기반의 클라우드 네이티브 애플리케이션을 개발하기 위한 프로젝트*
- 분산 시스템에서 필요한 다양한 기능들을 추상화하여 제공


### 2.1.1 Spring Cloud Config

: 애플리케이션 구성 데이터를 관리

- 애플리케이션 구성 데이터는 배포된 마이크로서비스에서 완전히 분리됨
    
    → 아무리 많은 마이크로서비스 인스턴스를 실행해도 항상 동일한 구성 보장
    

### 2.1.2 Service Discovery

: client에서 서버가 배포된 물리적 위치를 추상화 가능

: MSA 환경에서 서비스를 검색하고 호출하기 위한 기능

ex) consule 콘술, zookeeper, **eureka**


### 2.1.3 LoadBalancer와 Resilience4j

: 회복성 패턴을 위해 Resilience4j 라이브러리와 스프링 클라우드 로드 밸런서 프로젝트를 포함하여 마이크로서비스 내부에서 이들을 사용하여 편리하게 구현 가능

- Resilience4j 사용시 → 회로 차단기, 재시도, 벌크헤드 등 서비스 클라이언트 회복성 패턴을 빠르게 구현 가능
- 로드 밸런서는 여러 개의 인스턴스에서 제공되는 서비스를 균등하게 분산시켜 주는 기능


### 2.1.4 API Gateway

: API를 단일 진입점으로 노출시켜 주는 역할, 서비스 라우팅 기능을 제공

https://spring.io/projects/spring-cloud-gateway


### 2.1.5 Stream

: 경량 메시지 처리 기능을 마이크로서비스에 쉽게 통합하는 기술

: 애플리케이션에서 발생하는 비동기 이벤트를 사용하는 지능형 마이크로서비스 구축 가능

: RabbitMQ, Kafka 같은 메시지 브로커와 마이크로서비스 빠르게 통합 가능


### 2.1.6 Sleuth

: 고유한 **추적** 식별자를 애플리케이션에서 사용되는 HTTP 호출 및 메시지 채널(RabbitMQ, Kafka)에 통합 

- ELK 스택, 집킨 등과 결합될 때 발현


### 2.1.7 Security

: 서비스에 엑세스할 수 있는 사용자와 이 사용자가 서비스에서 수행할 수 있는 작업을 제어하는 인증 및 인가 프레임워크

- 토큰을 기반으로 하기 때문에 서비스는 인증 시스템에서 발급된 토큰을 사용하여 서로 통신 가능

<br>

## 2.2 클라우드 네이티브 마이크로서비스 구축 방법

클라우드 애플리케이션의 유형 두 가지

- 클라우드 레디(cloud-ready) 애플리케이션
    
    : 현장에 구축된 서버에서 사용되었던 애플리케이션 즉, 기존 애플리케이션을 클라우드에서 운영할 수 있도록 적응
    
    - 애플리케이션의 구성 정보를 외부화하여 다양한 환경에 맞게 신속히 적용할 수 있어야 함
    - 빌드 중에 소스 코드를 변경하지 않고 여러 환경서 실행될 수 있어야 함
    
    ↔ 클라우드 언레디 : DB 구성이 한 종류만 있는 로컬용으로 각 설치 환경에 따라 설정 변경 필요
    
- 클라우드 네이티브(cloud-native) 애플리케이션
    
    : 클라우드 컴퓨팅 아키텍처의 모든 이점(높은 확장성, 유연한 리소스 관리, 빠른 배포 주기)과 서비스를 활용할 수 있도록 설계
    
    - 기능을 컨테이너 같은 확장 가능한 마이크로서비스로 나누어 여러 서버에 실행할 수 있음
    - 클라우드의 모든 기능을 극대화하여 설계 구축
    
    **특징**
    
    - **마이크로서비스 아키텍처:** 각 기능이 작고 독립적인 마이크로서비스로 분리되어 구축
    - **컨테이너화 및 오케스트레이션:** 컨테이너(Docker 등)을 사용하여 애플리케이션을 패키징하고, Kubernetes 같은 오케스트레이션 도구를 통해 관리
    - **데브옵스 및 CI/CD:** 지속적 통합 및 배포를 위한 자동화된 파이프라인 구축
    - **자동 스케일링:** 클라우드의 자동 스케일링 기능을 이용하여 트래픽 변화에 따라 자동으로 리소스 조절
    - **네이티브 서비스 활용:** 클라우드 제공자가 제공하는 다양한 서비스(예: 데이터베이스, 메시징 시스템)을 적극적으로 활용

- 12팩터 앱
    
    : 클라우드 네이티브 마이크로서비스를 만들때 참고할 수 있는 모범 사례 지침
    
    ⇒ 설계 단계에서 꼼꼼하게 체크를 해줄 필요가 있다!
    
    ![image](https://github.com/user-attachments/assets/236b1094-50eb-4f05-bb4d-3548688dab8c)

    코드베이스, 의존성, 구성정보, 백엔드 서비스, 빌드 릴리스 실행, 프로세스, 포트 바인딩, 동시성, 페기 가능, 개발 및 운영 환경 일치, 로그, 관리 프로세스
    
    [12-Factors 란](https://medium.com/dtevangelist/12-factors-%EB%9E%80-b39c7ef1ed30)
